1. 新增 products 产品时，自动添加没有使用过的 jan_code， 自动添加没有使用过的gtin_code

JAN_CODE 处理逻辑：

1. 1138X2, 拆分成 1138 和 数量 2 。
2. 3400X3401, 需要分配一个新的 JAN_CODE 予之对应 。
3. 77778888, 不需要单独处理,直接当成一个JAN_CODE处理 。

```sql
SELECT ODC.JAN_CD AS jan_code, ODC.order_day AS order_date,SUM(ODC.AMOUNT) AS sale_count, SUM(ODC.AMOUNT_PRICE) AS sale_amount FROM ORDER_DETAILS_CALC ODC JOIN ORDERS O ON ODC.ORDER_NUMBER = O.ORDER_NUMBER
WHERE O.cancel_flag <> 2
GROUP BY ODC.JAN_CD,ODC.order_day
```

```sql
select cstocks.item_cd,csku.jan_code, cstocks.stock, cstocks.attribute1_name, cstocks.attribute2_name,odc.order_month,sum(odc.amount) as sale_count,sum(odc.amount_price) as sale_amount
from crossmall_item_stocks cstocks join crossmall_item_sku csku
on cstocks.item_cd = csku.item_code
and cstocks.attribute1_name = csku.attribute1_name
and cstocks.attribute2_name = csku.attribute2_name
and cstocks.stock>0
join order_details_calc odc on odc.jan_cd = csku.jan_code
join products p on odc.jan_cd = p.jan_code
where p.status = 1
-- where csku.jan_code = '2118'
group by cstocks.item_cd,csku.jan_code, cstocks.stock, cstocks.attribute1_name, cstocks.attribute2_name,odc.order_month
order by csku.jan_code , odc.order_month asc
```

商品别数据统计

```sql
select os.shop_name,os.shop_code,os.delivery_date, odc.item_code,sg.managenumber, sum(odc.amount_price) as amount_price,
sum(odc.amount) as amount,  sum(round((odc.amount_price / os.subtotal_price)* os.tax_total_price_10)) as tax_price,
sum(round((odc.amount_price / os.subtotal_price)* os.coupon)) as coupon,sum(round((odc.amount_price / os.subtotal_price)* os.point)) as point
from orders os join order_details_calc odc 
on os.order_number = odc.order_number
left join shop_good sg on odc.item_code = sg.itemnumber 
-- where os.delivery_date <= '2024-12-31' 
-- and os.delivery_date is not null 
and os.cancel_flag <> 2 
group by os.shop_name,os.delivery_date, odc.item_code,sg.managenumber,os.shop_code
order by delivery_date desc


SELECT effectdate,shopid,itemurl,sum(total720hcv) as total720hcv,sum(total720hgms) as total720hgms  
FROM report_goods
-- where effectdate = '2024-12-25' 
group by itemurl,shopid,effectdate
order by effectdate desc

```

```sql
-- 初始化 sales_summary 数据
INSERT INTO public.sales_summary(
 shopid, shop_name, shop_code, delivery_date, item_code, managenumber, amount_price, amount,
 tax_price, coupon, point, total720hcv, total720hgms)
select gss.shopid, os.shop_name,os.shop_code,os.delivery_date, odc.item_code,sg.manage_code as managenumber, 
 sum(odc.amount_price) as amount_price,
 sum(odc.amount) as amount,  
 sum(round((odc.amount_price / os.subtotal_price)* os.tax_total_price_10)) as tax_price,
 sum(round((odc.amount_price / os.subtotal_price)* os.coupon)) as coupon,
 sum(round((odc.amount_price / os.subtotal_price)* os.point)) as point,
 sum(rgs.total720hcv) as total720hcv,
 sum(rgs.total720hgms) as total720hgms  
 
 from orders os join order_details_calc odc 
 on os.order_number = odc.order_number
 join graceful_shops gss on os.shop_code = gss.shop_code
 left join itemcode_itemmanagecode_mapping sg on odc.item_code = sg.item_code 
 left join report_goods rgs 
 -- on rgs.effectdate = '2024-12-29' and 
 on rgs.periodtype = 0 and rgs.shopid = gss.shopid  and rgs.itemurl = sg.manage_code
 -- where os.delivery_date = '2024-12-29'
 -- and os.delivery_date is not null 
 and os.cancel_flag <> 2 
 group by gss.shopid, os.shop_name,os.delivery_date, odc.item_code,sg.manage_code,os.shop_code
```
